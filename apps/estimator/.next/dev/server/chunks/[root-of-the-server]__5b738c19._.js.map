{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayanosman/dev-portfolio/packages/ai/src/openrouter.ts"],"sourcesContent":["/**\n * OpenRouter AI Client\n * Supports multiple models: Claude, GPT-4, Gemini, etc.\n */\n\nconst OPENROUTER_API_KEY = process.env.OPENROUTER_API_KEY || \"\";\nconst OPENROUTER_API_URL = \"https://openrouter.ai/api/v1/chat/completions\";\n\nexport interface OpenRouterMessage {\n  role: \"system\" | \"user\" | \"assistant\";\n  content: string;\n}\n\nexport interface OpenRouterOptions {\n  model?: string;\n  temperature?: number;\n  max_tokens?: number;\n}\n\n/**\n * Call OpenRouter API with any model\n */\nexport async function callOpenRouter(\n  messages: OpenRouterMessage[],\n  options: OpenRouterOptions = {}\n) {\n  const {\n    model = \"anthropic/claude-3.5-sonnet\", // Default to Claude 3.5 Sonnet\n    temperature = 0.7,\n    max_tokens = 4096,\n  } = options;\n\n  const response = await fetch(OPENROUTER_API_URL, {\n    method: \"POST\",\n    headers: {\n      Authorization: `Bearer ${OPENROUTER_API_KEY}`,\n      \"Content-Type\": \"application/json\",\n      \"HTTP-Referer\": process.env.NEXT_PUBLIC_SITE_URL || \"http://localhost:3001\",\n      \"X-Title\": \"KoreTek Project Estimator\",\n    },\n    body: JSON.stringify({\n      model,\n      messages,\n      temperature,\n      max_tokens,\n    }),\n  });\n\n  if (!response.ok) {\n    const error = await response.text();\n    throw new Error(`OpenRouter API error: ${error}`);\n  }\n\n  const data = await response.json();\n  return data.choices[0]?.message?.content || \"\";\n}\n\n/**\n * Available models on OpenRouter\n */\nexport const MODELS = {\n  // Claude models (Anthropic)\n  CLAUDE_35_SONNET: \"anthropic/claude-3.5-sonnet\",\n  CLAUDE_3_OPUS: \"anthropic/claude-3-opus\",\n  CLAUDE_3_HAIKU: \"anthropic/claude-3-haiku\",\n\n  // GPT models (OpenAI)\n  GPT_4_TURBO: \"openai/gpt-4-turbo\",\n  GPT_4: \"openai/gpt-4\",\n  GPT_35_TURBO: \"openai/gpt-3.5-turbo\",\n\n  // Google models\n  GEMINI_PRO: \"google/gemini-pro\",\n\n  // Meta models\n  LLAMA_2_70B: \"meta-llama/llama-2-70b-chat\",\n} as const;\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAED,MAAM,qBAAqB,QAAQ,GAAG,CAAC,kBAAkB,IAAI;AAC7D,MAAM,qBAAqB;AAgBpB,eAAe,eACpB,QAA6B,EAC7B,UAA6B,CAAC,CAAC;IAE/B,MAAM,EACJ,QAAQ,6BAA6B,EACrC,cAAc,GAAG,EACjB,aAAa,IAAI,EAClB,GAAG;IAEJ,MAAM,WAAW,MAAM,MAAM,oBAAoB;QAC/C,QAAQ;QACR,SAAS;YACP,eAAe,CAAC,OAAO,EAAE,oBAAoB;YAC7C,gBAAgB;YAChB,gBAAgB,6DAAoC;YACpD,WAAW;QACb;QACA,MAAM,KAAK,SAAS,CAAC;YACnB;YACA;YACA;YACA;QACF;IACF;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;QACjC,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,OAAO;IAClD;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,OAAO,KAAK,OAAO,CAAC,EAAE,EAAE,SAAS,WAAW;AAC9C;AAKO,MAAM,SAAS;IACpB,4BAA4B;IAC5B,kBAAkB;IAClB,eAAe;IACf,gBAAgB;IAEhB,sBAAsB;IACtB,aAAa;IACb,OAAO;IACP,cAAc;IAEd,gBAAgB;IAChB,YAAY;IAEZ,cAAc;IACd,aAAa;AACf"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/ayanosman/dev-portfolio/apps/estimator/app/api/refine-estimate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { callOpenRouter, MODELS } from \"@repo/ai/openrouter\";\nimport type { ProjectEstimate } from \"@repo/ai/types\";\n\ninterface QuestionAnswer {\n  question: string;\n  answer: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { projectDescription, originalEstimate, answeredQuestions } = await request.json();\n\n    if (!projectDescription || !originalEstimate || !answeredQuestions) {\n      return NextResponse.json(\n        { error: \"Missing required fields\" },\n        { status: 400 }\n      );\n    }\n\n    // Build the refinement prompt\n    const answeredQuestionsText = answeredQuestions\n      .filter((qa: QuestionAnswer) => qa.answer && qa.answer !== \"Not answered\")\n      .map((qa: QuestionAnswer) => `- ${qa.question}: ${qa.answer}`)\n      .join(\"\\n\");\n\n    const systemPrompt = `You are an expert software development consultant. You previously provided an estimate for a project and asked clarifying questions. The client has now answered those questions.\n\nYour task is to refine the original estimate based on their answers. Focus on:\n1. Adding or removing features based on their answers\n2. Adjusting the tech stack if needed\n3. Updating risks and next steps\n4. Asking new, more specific questions (with options when appropriate)\n\nIMPORTANT: For the questions array, use the same format as before:\n- Simple yes/no questions as strings: \"Do you need offline support?\"\n- Questions with specific options as objects: { \"text\": \"Preferred approach?\", \"options\": [\"Option 1\", \"Option 2\"] }\n\nReturn a refined estimate in the same JSON format as before.`;\n\n    const userPrompt = `Original Project: \"${projectDescription}\"\n\nOriginal Estimate Summary: ${originalEstimate.summary}\n\nClient's Answers to Questions:\n${answeredQuestionsText || \"No questions answered yet\"}\n\nPlease provide a refined estimate in JSON format with this structure:\n{\n  \"projectName\": \"Updated project name\",\n  \"summary\": \"Updated 2-3 sentence summary reflecting their answers\",\n  \"features\": [\"updated feature list based on their requirements\"],\n  \"techStack\": {\n    \"frontend\": [\"...\"],\n    \"backend\": [\"...\"],\n    \"database\": [\"...\"],\n    \"infrastructure\": [\"...\"]\n  },\n  \"risks\": [\"updated risks\"],\n  \"nextSteps\": [\"updated next steps\"],\n  \"questions\": [\n    \"Simple yes/no question?\",\n    { \"text\": \"Question with options?\", \"options\": [\"Option 1\", \"Option 2\", \"Option 3\"] }\n  ]\n}`;\n\n    const response = await callOpenRouter(\n      [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userPrompt },\n      ],\n      {\n        model: MODELS.CLAUDE_35_SONNET,\n        temperature: 0.7,\n        max_tokens: 1200,\n      }\n    );\n\n    // Parse JSON from response\n    const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      throw new Error(\"Failed to extract JSON from AI response\");\n    }\n\n    const estimate: ProjectEstimate = JSON.parse(jsonMatch[0]);\n    return NextResponse.json({ estimate });\n  } catch (error) {\n    console.error(\"Error refining estimate:\", error);\n    return NextResponse.json(\n      { error: \"Failed to refine estimate. Please try again.\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,kBAAkB,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEtF,IAAI,CAAC,sBAAsB,CAAC,oBAAoB,CAAC,mBAAmB;YAClE,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,MAAM,wBAAwB,kBAC3B,MAAM,CAAC,CAAC,KAAuB,GAAG,MAAM,IAAI,GAAG,MAAM,KAAK,gBAC1D,GAAG,CAAC,CAAC,KAAuB,CAAC,EAAE,EAAE,GAAG,QAAQ,CAAC,EAAE,EAAE,GAAG,MAAM,EAAE,EAC5D,IAAI,CAAC;QAER,MAAM,eAAe,CAAC;;;;;;;;;;;;4DAYkC,CAAC;QAEzD,MAAM,aAAa,CAAC,mBAAmB,EAAE,mBAAmB;;2BAErC,EAAE,iBAAiB,OAAO,CAAC;;;AAGtD,EAAE,yBAAyB,4BAA4B;;;;;;;;;;;;;;;;;;;CAmBtD,CAAC;QAEE,MAAM,WAAW,MAAM,IAAA,uJAAc,EACnC;YACE;gBAAE,MAAM;gBAAU,SAAS;YAAa;YACxC;gBAAE,MAAM;gBAAQ,SAAS;YAAW;SACrC,EACD;YACE,OAAO,+IAAM,CAAC,gBAAgB;YAC9B,aAAa;YACb,YAAY;QACd;QAGF,2BAA2B;QAC3B,MAAM,YAAY,SAAS,KAAK,CAAC;QACjC,IAAI,CAAC,WAAW;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,WAA4B,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;QACzD,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE;QAAS;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+C,GACxD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}